<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Authentication using OAuth | The Qt 6 Book</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="A book about QML">
    
    <link rel="preload" href="/assets/css/0.styles.92ea4280.css" as="style"><link rel="preload" href="/assets/js/app.85861ea8.js" as="script"><link rel="preload" href="/assets/js/2.26c961b2.js" as="script"><link rel="preload" href="/assets/js/26.cdd6b54d.js" as="script"><link rel="prefetch" href="/assets/js/10.4395bd95.js"><link rel="prefetch" href="/assets/js/100.fa302cac.js"><link rel="prefetch" href="/assets/js/101.8d466e46.js"><link rel="prefetch" href="/assets/js/102.8e83581a.js"><link rel="prefetch" href="/assets/js/103.a82c478d.js"><link rel="prefetch" href="/assets/js/104.28055030.js"><link rel="prefetch" href="/assets/js/105.f0d68af0.js"><link rel="prefetch" href="/assets/js/106.bb60723a.js"><link rel="prefetch" href="/assets/js/107.7d45025a.js"><link rel="prefetch" href="/assets/js/108.0ed7a1f6.js"><link rel="prefetch" href="/assets/js/109.8946b3a4.js"><link rel="prefetch" href="/assets/js/11.b85f8031.js"><link rel="prefetch" href="/assets/js/110.11bd09cb.js"><link rel="prefetch" href="/assets/js/111.71acb487.js"><link rel="prefetch" href="/assets/js/112.fcf7de4a.js"><link rel="prefetch" href="/assets/js/113.2c5c65d1.js"><link rel="prefetch" href="/assets/js/114.d0eb4c04.js"><link rel="prefetch" href="/assets/js/115.760f698b.js"><link rel="prefetch" href="/assets/js/116.d3e7387b.js"><link rel="prefetch" href="/assets/js/117.1b1a7a03.js"><link rel="prefetch" href="/assets/js/118.e2bdad72.js"><link rel="prefetch" href="/assets/js/119.2e2f773b.js"><link rel="prefetch" href="/assets/js/12.83c6e34c.js"><link rel="prefetch" href="/assets/js/120.35cbc8cf.js"><link rel="prefetch" href="/assets/js/121.3671b29f.js"><link rel="prefetch" href="/assets/js/122.d462ba81.js"><link rel="prefetch" href="/assets/js/123.68da5c9a.js"><link rel="prefetch" href="/assets/js/124.0476127d.js"><link rel="prefetch" href="/assets/js/125.05527bc4.js"><link rel="prefetch" href="/assets/js/126.da700bd1.js"><link rel="prefetch" href="/assets/js/127.bba7328d.js"><link rel="prefetch" href="/assets/js/128.d06333ea.js"><link rel="prefetch" href="/assets/js/129.77aee385.js"><link rel="prefetch" href="/assets/js/13.b44307e8.js"><link rel="prefetch" href="/assets/js/130.b7e1846a.js"><link rel="prefetch" href="/assets/js/131.df7ded7d.js"><link rel="prefetch" href="/assets/js/132.eaa7412d.js"><link rel="prefetch" href="/assets/js/14.4daf5b31.js"><link rel="prefetch" href="/assets/js/15.8dfe57f5.js"><link rel="prefetch" href="/assets/js/16.ae047bb1.js"><link rel="prefetch" href="/assets/js/17.97cb1999.js"><link rel="prefetch" href="/assets/js/18.09368857.js"><link rel="prefetch" href="/assets/js/19.fd59ff42.js"><link rel="prefetch" href="/assets/js/20.6398077d.js"><link rel="prefetch" href="/assets/js/21.6a05a693.js"><link rel="prefetch" href="/assets/js/22.947a34c5.js"><link rel="prefetch" href="/assets/js/23.c793e061.js"><link rel="prefetch" href="/assets/js/24.d60c1260.js"><link rel="prefetch" href="/assets/js/25.f5cfb5dd.js"><link rel="prefetch" href="/assets/js/27.2e40b24c.js"><link rel="prefetch" href="/assets/js/28.a44092e5.js"><link rel="prefetch" href="/assets/js/29.0b58d719.js"><link rel="prefetch" href="/assets/js/3.15609819.js"><link rel="prefetch" href="/assets/js/30.13230c3d.js"><link rel="prefetch" href="/assets/js/31.02bb2aa2.js"><link rel="prefetch" href="/assets/js/32.900bae89.js"><link rel="prefetch" href="/assets/js/33.809d8313.js"><link rel="prefetch" href="/assets/js/34.b22e38fe.js"><link rel="prefetch" href="/assets/js/35.e0175be4.js"><link rel="prefetch" href="/assets/js/36.5df92709.js"><link rel="prefetch" href="/assets/js/37.2a36790b.js"><link rel="prefetch" href="/assets/js/38.7f2d9d42.js"><link rel="prefetch" href="/assets/js/39.2150f302.js"><link rel="prefetch" href="/assets/js/4.abbcf459.js"><link rel="prefetch" href="/assets/js/40.418ab892.js"><link rel="prefetch" href="/assets/js/41.8613e33c.js"><link rel="prefetch" href="/assets/js/42.fd4fbf33.js"><link rel="prefetch" href="/assets/js/43.a1d7c212.js"><link rel="prefetch" href="/assets/js/44.6668e30e.js"><link rel="prefetch" href="/assets/js/45.afe197bb.js"><link rel="prefetch" href="/assets/js/46.746cdebe.js"><link rel="prefetch" href="/assets/js/47.be6ca186.js"><link rel="prefetch" href="/assets/js/48.2f55198b.js"><link rel="prefetch" href="/assets/js/49.8cd15ae8.js"><link rel="prefetch" href="/assets/js/5.3e69f88a.js"><link rel="prefetch" href="/assets/js/50.dbabd303.js"><link rel="prefetch" href="/assets/js/51.d8b5ec87.js"><link rel="prefetch" href="/assets/js/52.12f7375a.js"><link rel="prefetch" href="/assets/js/53.eed8ca8f.js"><link rel="prefetch" href="/assets/js/54.c4d75775.js"><link rel="prefetch" href="/assets/js/55.b1783490.js"><link rel="prefetch" href="/assets/js/56.5901bd6c.js"><link rel="prefetch" href="/assets/js/57.95985066.js"><link rel="prefetch" href="/assets/js/58.d098dc2b.js"><link rel="prefetch" href="/assets/js/59.f534f5f5.js"><link rel="prefetch" href="/assets/js/6.599da621.js"><link rel="prefetch" href="/assets/js/60.0398dfb7.js"><link rel="prefetch" href="/assets/js/61.56fd70e0.js"><link rel="prefetch" href="/assets/js/62.b84b32ba.js"><link rel="prefetch" href="/assets/js/63.c521b8ab.js"><link rel="prefetch" href="/assets/js/64.2bf1e6e2.js"><link rel="prefetch" href="/assets/js/65.0a769062.js"><link rel="prefetch" href="/assets/js/66.a7c4130c.js"><link rel="prefetch" href="/assets/js/67.df2ba082.js"><link rel="prefetch" href="/assets/js/68.8a6223f5.js"><link rel="prefetch" href="/assets/js/69.216e47e2.js"><link rel="prefetch" href="/assets/js/7.4b835f9d.js"><link rel="prefetch" href="/assets/js/70.63f79832.js"><link rel="prefetch" href="/assets/js/71.f5bdf6b7.js"><link rel="prefetch" href="/assets/js/72.a8cf8fb8.js"><link rel="prefetch" href="/assets/js/73.3538ebde.js"><link rel="prefetch" href="/assets/js/74.63b1b93e.js"><link rel="prefetch" href="/assets/js/75.4d0beaa9.js"><link rel="prefetch" href="/assets/js/76.7d3c932a.js"><link rel="prefetch" href="/assets/js/77.90fe8238.js"><link rel="prefetch" href="/assets/js/78.94404738.js"><link rel="prefetch" href="/assets/js/79.ee568c52.js"><link rel="prefetch" href="/assets/js/8.e9c62eff.js"><link rel="prefetch" href="/assets/js/80.e200eac0.js"><link rel="prefetch" href="/assets/js/81.634d249d.js"><link rel="prefetch" href="/assets/js/82.484db6b7.js"><link rel="prefetch" href="/assets/js/83.6154fd3d.js"><link rel="prefetch" href="/assets/js/84.24b8d4cb.js"><link rel="prefetch" href="/assets/js/85.6c107d50.js"><link rel="prefetch" href="/assets/js/86.f87351fc.js"><link rel="prefetch" href="/assets/js/87.a87dddc8.js"><link rel="prefetch" href="/assets/js/88.155ec451.js"><link rel="prefetch" href="/assets/js/89.64bcf5e9.js"><link rel="prefetch" href="/assets/js/9.fc273458.js"><link rel="prefetch" href="/assets/js/90.19f96ff1.js"><link rel="prefetch" href="/assets/js/91.6124d2ee.js"><link rel="prefetch" href="/assets/js/92.e625e357.js"><link rel="prefetch" href="/assets/js/93.a66de41e.js"><link rel="prefetch" href="/assets/js/94.56f157b5.js"><link rel="prefetch" href="/assets/js/95.9677e971.js"><link rel="prefetch" href="/assets/js/96.c4114f1e.js"><link rel="prefetch" href="/assets/js/97.d64a40ed.js"><link rel="prefetch" href="/assets/js/98.c46e9482.js"><link rel="prefetch" href="/assets/js/99.c23f6710.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92ea4280.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">The Qt 6 Book</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/qmlbook/qt6book" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/qmlbook/qt6book" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/preface/preface" class="sidebar-heading clickable"><span>Preface</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/preface/preface.html" class="sidebar-link">Welcome!</a></li><li><a href="/preface/acknowledgements.html" class="sidebar-link">Acknowledgements</a></li><li><a href="/preface/authors.html" class="sidebar-link">Authors</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch01-meetqt/meet-qt" class="sidebar-heading clickable"><span>Meet Qt</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch01-meetqt/meet-qt.html" class="sidebar-link">Qt and Qt Quick</a></li><li><a href="/ch01-meetqt/blocks.html" class="sidebar-link">Qt Building Blocks</a></li><li><a href="/ch01-meetqt/intro.html" class="sidebar-link">Qt 6 Introduction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch02-start/quick-start" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch02-start/quick-start.html" class="sidebar-link">Quick Start</a></li><li><a href="/ch02-start/install.html" class="sidebar-link">Installing Qt 6 SDK</a></li><li><a href="/ch02-start/hello-world.html" class="sidebar-link">Hello World</a></li><li><a href="/ch02-start/app-types.html" class="sidebar-link">Application Types</a></li><li><a href="/ch02-start/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch03-qtcreator/qt-creator" class="sidebar-heading clickable"><span>Qt Creator IDE</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch03-qtcreator/qt-creator.html" class="sidebar-link">Qt Creator IDE</a></li><li><a href="/ch03-qtcreator/user-interface.html" class="sidebar-link">The User Interface</a></li><li><a href="/ch03-qtcreator/kit-registry.html" class="sidebar-link">Registering your Qt Kit</a></li><li><a href="/ch03-qtcreator/projects.html" class="sidebar-link">Managing Projects</a></li><li><a href="/ch03-qtcreator/editor.html" class="sidebar-link">Using the Editor</a></li><li><a href="/ch03-qtcreator/locator.html" class="sidebar-link">Locator</a></li><li><a href="/ch03-qtcreator/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/ch03-qtcreator/shortcuts.html" class="sidebar-link">Shortcuts</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch04-qmlstart/quick-start" class="sidebar-heading clickable"><span>Quick Starter</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch04-qmlstart/quick-start.html" class="sidebar-link">Quick Starter</a></li><li><a href="/ch04-qmlstart/qml-syntax.html" class="sidebar-link">QML Syntax</a></li><li><a href="/ch04-qmlstart/core-elements.html" class="sidebar-link">Core Elements</a></li><li><a href="/ch04-qmlstart/components.html" class="sidebar-link">Components</a></li><li><a href="/ch04-qmlstart/transformations.html" class="sidebar-link">Simple Transformations</a></li><li><a href="/ch04-qmlstart/positioning.html" class="sidebar-link">Positioning Elements</a></li><li><a href="/ch04-qmlstart/layout.html" class="sidebar-link">Layout Items</a></li><li><a href="/ch04-qmlstart/input.html" class="sidebar-link">Input Elements</a></li><li><a href="/ch04-qmlstart/advanced.html" class="sidebar-link">Advanced Techniques</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch05-fluid/fluid-elements" class="sidebar-heading clickable"><span>Fluid Elements</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch05-fluid/fluid-elements.html" class="sidebar-link">Fluid Elements</a></li><li><a href="/ch05-fluid/animations.html" class="sidebar-link">Animations</a></li><li><a href="/ch05-fluid/states-transitions.html" class="sidebar-link">States and Transitions</a></li><li><a href="/ch05-fluid/advanced.html" class="sidebar-link">Advanced Techniques</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch06-controls/controls2" class="sidebar-heading clickable"><span>QtQuick Controls</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch06-controls/controls2.html" class="sidebar-link">UI Controls</a></li><li><a href="/ch06-controls/introduction.html" class="sidebar-link">Introduction to Controls</a></li><li><a href="/ch06-controls/image-viewer.html" class="sidebar-link">An Image Viewer</a></li><li><a href="/ch06-controls/common-patterns.html" class="sidebar-link">Common Patterns</a></li><li><a href="/ch06-controls/imagine-style.html" class="sidebar-link">The Imagine Style</a></li><li><a href="/ch06-controls/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch07-modelview/model-view" class="sidebar-heading clickable"><span>Model View</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch07-modelview/model-view.html" class="sidebar-link">Model-View-Delegate</a></li><li><a href="/ch07-modelview/concept.html" class="sidebar-link">Concept</a></li><li><a href="/ch07-modelview/basic-models.html" class="sidebar-link">Basic Models</a></li><li><a href="/ch07-modelview/dynamic-views.html" class="sidebar-link">Dynamic Views</a></li><li><a href="/ch07-modelview/delegate.html" class="sidebar-link">Delegate</a></li><li><a href="/ch07-modelview/advanced.html" class="sidebar-link">Advanced Techniques</a></li><li><a href="/ch07-modelview/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch08-canvas/canvas-element" class="sidebar-heading clickable"><span>Canvas</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch08-canvas/canvas-element.html" class="sidebar-link">Canvas Element</a></li><li><a href="/ch08-canvas/convenience-api.html" class="sidebar-link">Convenience API</a></li><li><a href="/ch08-canvas/gradients.html" class="sidebar-link">Gradients</a></li><li><a href="/ch08-canvas/shadows.html" class="sidebar-link">Shadows</a></li><li><a href="/ch08-canvas/images.html" class="sidebar-link">Images</a></li><li><a href="/ch08-canvas/transformation.html" class="sidebar-link">Transformation</a></li><li><a href="/ch08-canvas/composition-modes.html" class="sidebar-link">Composition Modes</a></li><li><a href="/ch08-canvas/pixel-buffer.html" class="sidebar-link">Pixel Buffers</a></li><li><a href="/ch08-canvas/canvas-paint.html" class="sidebar-link">Canvas Paint</a></li><li><a href="/ch08-canvas/port-from-html.html" class="sidebar-link">Porting from HTML5 Canvas</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch09-shapes/shapes" class="sidebar-heading clickable"><span>Shapes</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch09-shapes/shapes.html" class="sidebar-link">Shapes</a></li><li><a href="/ch09-shapes/basics.html" class="sidebar-link">A Basic Shape</a></li><li><a href="/ch09-shapes/paths.html" class="sidebar-link">Building Paths</a></li><li><a href="/ch09-shapes/gradients.html" class="sidebar-link">Filling Shapes</a></li><li><a href="/ch09-shapes/animations.html" class="sidebar-link">Animating Shapes</a></li><li><a href="/ch09-shapes/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch10-effects/effects" class="sidebar-heading clickable"><span>Effects</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch10-effects/effects.html" class="sidebar-link">Effects in QML</a></li><li><a href="/ch10-effects/particles.html" class="sidebar-link">Particle Concept</a></li><li><a href="/ch10-effects/simple-simulation.html" class="sidebar-link">Simple Simulation</a></li><li><a href="/ch10-effects/particle-parameters.html" class="sidebar-link">Particle Parameters</a></li><li><a href="/ch10-effects/directed-particles.html" class="sidebar-link">Directed Particles</a></li><li><a href="/ch10-effects/affecting-particles.html" class="sidebar-link">Affecting Particles</a></li><li><a href="/ch10-effects/particle-groups.html" class="sidebar-link">Particle Groups</a></li><li><a href="/ch10-effects/particle-painters.html" class="sidebar-link">Particle Painters</a></li><li><a href="/ch10-effects/opengl-shaders.html" class="sidebar-link">Graphics Shaders</a></li><li><a href="/ch10-effects/shader-elements.html" class="sidebar-link">Shader Elements</a></li><li><a href="/ch10-effects/fragment-shaders.html" class="sidebar-link">Fragment Shaders</a></li><li><a href="/ch10-effects/wave-effect.html" class="sidebar-link">Wave Effect</a></li><li><a href="/ch10-effects/vertex-shader.html" class="sidebar-link">Vertex Shader</a></li><li><a href="/ch10-effects/curtain-effect.html" class="sidebar-link">Curtain Effect</a></li><li><a href="/ch10-effects/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch11-multimedia/multimedia" class="sidebar-heading clickable"><span>Multimedia</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch11-multimedia/multimedia.html" class="sidebar-link">Multimedia</a></li><li><a href="/ch11-multimedia/playing-media.html" class="sidebar-link">Playing Media</a></li><li><a href="/ch11-multimedia/sound-effects.html" class="sidebar-link">Sound Effects</a></li><li><a href="/ch11-multimedia/video-streams.html" class="sidebar-link">Video Streams</a></li><li><a href="/ch11-multimedia/capturing-images.html" class="sidebar-link">Capturing Images</a></li><li><a href="/ch11-multimedia/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch12-networking/networking" class="sidebar-heading clickable open"><span>Networking</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch12-networking/networking.html" class="sidebar-link">Networking</a></li><li><a href="/ch12-networking/serve-qml.html" class="sidebar-link">Serving UI via HTTP</a></li><li><a href="/ch12-networking/templates.html" class="sidebar-link">Templates</a></li><li><a href="/ch12-networking/http-requests.html" class="sidebar-link">HTTP Requests</a></li><li><a href="/ch12-networking/local-files.html" class="sidebar-link">Local files</a></li><li><a href="/ch12-networking/rest-api.html" class="sidebar-link">REST API</a></li><li><a href="/ch12-networking/authentication.html" aria-current="page" class="active sidebar-link">Authentication using OAuth</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ch12-networking/authentication.html#integration-example" class="sidebar-link">Integration example</a></li></ul></li><li><a href="/ch12-networking/web-sockets.html" class="sidebar-link">Web Sockets</a></li><li><a href="/ch12-networking/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch13-storage/storage" class="sidebar-heading clickable"><span>Storage</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch13-storage/storage.html" class="sidebar-link">Storage</a></li><li><a href="/ch13-storage/settings.html" class="sidebar-link">Settings</a></li><li><a href="/ch13-storage/local-storage.html" class="sidebar-link">Local Storage - SQL</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch14-dynamicqml/dynamic-qml" class="sidebar-heading clickable"><span>Dynamic QML</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch14-dynamicqml/dynamic-qml.html" class="sidebar-link">Dynamic QML</a></li><li><a href="/ch14-dynamicqml/loading-components.html" class="sidebar-link">Loading Components Dynamically</a></li><li><a href="/ch14-dynamicqml/dynamic-objects.html" class="sidebar-link">Creating and Destroying Objects</a></li><li><a href="/ch14-dynamicqml/tracking-objects.html" class="sidebar-link">Tracking Dynamic Objects</a></li><li><a href="/ch14-dynamicqml/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch15-javascript/javascript" class="sidebar-heading clickable"><span>Javascript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch15-javascript/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/ch15-javascript/html-qml.html" class="sidebar-link">Browser/HTML vs Qt Quick/QML</a></li><li><a href="/ch15-javascript/js-language.html" class="sidebar-link">JS Language</a></li><li><a href="/ch15-javascript/js-objects.html" class="sidebar-link">JS Objects</a></li><li><a href="/ch15-javascript/js-console.html" class="sidebar-link">Creating a JS Console</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch16-qtcpp/qtcpp" class="sidebar-heading clickable"><span>Qt C++</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch16-qtcpp/qtcpp.html" class="sidebar-link">Qt and C++</a></li><li><a href="/ch16-qtcpp/boilerplate.html" class="sidebar-link">A Boilerplate Application</a></li><li><a href="/ch16-qtcpp/qobject.html" class="sidebar-link">The QObject</a></li><li><a href="/ch16-qtcpp/build-system.html" class="sidebar-link">Build Systems</a></li><li><a href="/ch16-qtcpp/common-classes.html" class="sidebar-link">Common Qt Classes</a></li><li><a href="/ch16-qtcpp/cpp-models.html" class="sidebar-link">Models in C++</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch17-extensions/extending-qml" class="sidebar-heading clickable"><span>Extending QML</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch17-extensions/extending-qml.html" class="sidebar-link">Extending QML with C++</a></li><li><a href="/ch17-extensions/qml-runtime.html" class="sidebar-link">Understanding the QML Run-time</a></li><li><a href="/ch17-extensions/plugin-content.html" class="sidebar-link">Plugin Content</a></li><li><a href="/ch17-extensions/create-plugin.html" class="sidebar-link">Creating the plugin</a></li><li><a href="/ch17-extensions/fileio-demo.html" class="sidebar-link">FileIO Implementation</a></li><li><a href="/ch17-extensions/using-fileio.html" class="sidebar-link">Using FileIO</a></li><li><a href="/ch17-extensions/summary.html" class="sidebar-link">Summary</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ch18-python/qt-python" class="sidebar-heading clickable"><span>Qt for Python</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ch18-python/qt-python.html" class="sidebar-link">Qt for Python</a></li><li><a href="/ch18-python/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/ch18-python/installing.html" class="sidebar-link">Installing</a></li><li><a href="/ch18-python/build-app.html" class="sidebar-link">Building an Application</a></li><li><a href="/ch18-python/limitations.html" class="sidebar-link">Limitations</a></li><li><a href="/ch18-python/summary.html" class="sidebar-link">Summary</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="authentication-using-oauth"><a href="#authentication-using-oauth" class="header-anchor">#</a> Authentication using OAuth</h1> <p>OAuth is an open protocol to allow secure authorization in a simple and standard method from web, mobile, and desktop applications. OAuth is used to authenticate a client against common web-services such as Google, Facebook, and Twitter.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>For a custom web-service you could also use the standard HTTP authentication for example by using the <code>XMLHttpRequest</code> username and password in the get method (e.g. <code>xhr.open(verb, url, true, username, password)</code>)</p></div> <p>OAuth is currently not part of a QML/JS API. So you would need to write some C++ code and export the authentication to QML/JS. Another issue would be the secure storage of the access token.</p> <p>Here are some links which we find useful:</p> <ul><li><a href="http://oauth.net/" target="_blank" rel="noopener noreferrer">http://oauth.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://hueniverse.com/oauth/" target="_blank" rel="noopener noreferrer">http://hueniverse.com/oauth/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/pipacs/o2" target="_blank" rel="noopener noreferrer">https://github.com/pipacs/o2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.johanpaul.com/blog/2011/05/oauth2-explained-with-qt-quick/" target="_blank" rel="noopener noreferrer">http://www.johanpaul.com/blog/2011/05/oauth2-explained-with-qt-quick/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="integration-example"><a href="#integration-example" class="header-anchor">#</a> Integration example</h2> <p>In this section, we will go through an example of OAuth integration using the <a href="https://developer.spotify.com/documentation/web-api/" target="_blank" rel="noopener noreferrer">Spotify API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This example uses a combination of C++ classes and QML/JS. To discover more on this integration, please refer to Chapter 16.</p> <p>This application's goal is to retrieve the top ten favourite artists of the authenticated user.</p> <h3 id="creating-the-app"><a href="#creating-the-app" class="header-anchor">#</a> Creating the App</h3> <p>First, you will need to create a dedicated app on the <a href="https://developer.spotify.com/dashboard/applications" target="_blank" rel="noopener noreferrer">Spotify Developer's portal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><img src="/assets/img/oauth-spotify-dashboard.8367971e.png" alt="image"></p> <p>Once your app is created, you'll receive two keys: a <code>client id</code> and a <code>client secret</code>.</p> <p><img src="/assets/img/oauth-spotify-app.88b3f71c.png" alt="image"></p> <h3 id="the-qml-file"><a href="#the-qml-file" class="header-anchor">#</a> The QML file</h3> <p>The process is divided in two phases:</p> <ol><li>The application connects to the Spotify API, which in turns requests the user to authorize it;</li> <li>If authorized, the application displays the list of the top ten favourite artists of the user.</li></ol> <h4 id="authorizing-the-app"><a href="#authorizing-the-app" class="header-anchor">#</a> Authorizing the app</h4> <p>Let's start with the first step:</p> <div class="language-qml extra-class"><pre class="language-qml"><code><span class="token keyword">import</span> QtQuick
<span class="token keyword">import</span> QtQuick.Window
<span class="token keyword">import</span> QtQuick.Controls

<span class="token keyword">import</span> Spotify</code></pre></div><p>When the application starts, we will first import a custom library, <code>Spotify</code>, that defines a <code>SpotifyAPI</code> component (we'll come to that later). This component will then be instanciated:</p> <div class="language-qml extra-class"><pre class="language-qml"><code><span class="token class-name">ApplicationWindow</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">320</span></span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">568</span></span>
    <span class="token property">visible</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token boolean">true</span></span>
    <span class="token property">title</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token function">qsTr</span><span class="token punctuation">(</span><span class="token string">&quot;Spotify OAuth2&quot;</span><span class="token punctuation">)</span></span>

    <span class="token class-name">BusyIndicator</span> <span class="token punctuation">{</span>
        <span class="token property">visible</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token operator">!</span>spotifyApi<span class="token punctuation">.</span>isAuthenticated</span>
        <span class="token property">anchors.centerIn</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">parent</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">SpotifyAPI</span> <span class="token punctuation">{</span>
        <span class="token property">id</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">spotifyApi</span>
        <span class="token property">onIsAuthenticatedChanged</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token keyword">if</span><span class="token punctuation">(</span>isAuthenticated<span class="token punctuation">)</span> spotifyModel<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
    <span class="token punctuation">}</span></code></pre></div><p>Once the application has been loaded, the <code>SpotifyAPI</code> component will request an authorization to Spotify:</p> <div class="language-qml extra-class"><pre class="language-qml"><code><span class="token property">Component.onCompleted</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token punctuation">{</span>
    spotifyApi<span class="token punctuation">.</span><span class="token function">setCredentials</span><span class="token punctuation">(</span><span class="token string">&quot;CLIENT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CLIENT_SECRET&quot;</span><span class="token punctuation">)</span>
    spotifyApi<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></span></code></pre></div><p>Until the authorization is provided, a busy indicator will be displayed in the center of the app.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Please note that for security reasons, the API credentials should never be put directly into a QML file!</p></div> <h4 id="listing-the-user-s-favorite-artists"><a href="#listing-the-user-s-favorite-artists" class="header-anchor">#</a> Listing the user's favorite artists</h4> <p>The next step happens when the authorization has been granted. To display the list of artists, we will use the Model/View/Delegate pattern:</p> <div class="language-qml extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-qml"><code><span class="token class-name">SpotifyModel</span> <span class="token punctuation">{</span>
    <span class="token property">id</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">spotifyModel</span>
    <span class="token property">spotifyApi</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">spotifyApi</span>
<span class="token punctuation">}</span>

<span class="token class-name">ListView</span> <span class="token punctuation">{</span>
    <span class="token property">visible</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">spotifyApi<span class="token punctuation">.</span>isAuthenticated</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">parent<span class="token punctuation">.</span>width</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">parent<span class="token punctuation">.</span>height</span>
    <span class="token property">model</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">spotifyModel</span>
    <span class="token property">delegate</span><span class="token punctuation">:</span> <span class="token class-name">Pane</span> <span class="token punctuation">{</span>
        <span class="token property">id</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">delegate</span>
        required property var model
        <span class="token property">topPadding</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">0</span></span>
        <span class="token class-name">Column</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">300</span></span>
            <span class="token property">spacing</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">10</span></span>

            <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
                <span class="token property">height</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">1</span></span>
                <span class="token property">width</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">parent<span class="token punctuation">.</span>width</span>
                <span class="token property">color</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">delegate<span class="token punctuation">.</span>model<span class="token punctuation">.</span>index <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&quot;#3d3d3d&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;transparent&quot;</span></span>
            <span class="token punctuation">}</span>

            <span class="token class-name">Row</span> <span class="token punctuation">{</span>
                <span class="token property">spacing</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">10</span></span>

                <span class="token class-name">Item</span> <span class="token punctuation">{</span>
                    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">20</span></span>
                    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">width</span>

                    <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
                        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">20</span></span>
                        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">20</span></span>
                        <span class="token property">anchors.top</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">parent<span class="token punctuation">.</span>top</span>
                        <span class="token property">anchors.right</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">parent<span class="token punctuation">.</span>right</span>
                        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token string">&quot;black&quot;</span></span>

                        <span class="token class-name">Label</span> <span class="token punctuation">{</span>
                            <span class="token property">anchors.centerIn</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">parent</span>
                            <span class="token property">font.pointSize</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">16</span></span>
                            <span class="token property">text</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">delegate<span class="token punctuation">.</span>model<span class="token punctuation">.</span>index <span class="token operator">+</span> <span class="token number">1</span></span>
                            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token string">&quot;white&quot;</span></span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token class-name">Image</span> <span class="token punctuation">{</span>
                    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">80</span></span>
                    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">width</span>
                    <span class="token property">source</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">delegate<span class="token punctuation">.</span>model<span class="token punctuation">.</span>imageURL</span>
                    <span class="token property">fillMode</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">Image<span class="token punctuation">.</span>PreserveAspectFit</span>
                <span class="token punctuation">}</span>

                <span class="token class-name">Column</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Label</span> <span class="token punctuation">{</span> 
                        <span class="token property">text</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript">delegate<span class="token punctuation">.</span>model<span class="token punctuation">.</span>name</span>
                        <span class="token property">font.pointSize</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token number">16</span></span>
                        <span class="token property">font.bold</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token boolean">true</span> </span>
                    <span class="token punctuation">}</span>
                    <span class="token class-name">Label</span> <span class="token punctuation">{</span> <span class="token property">text</span><span class="token punctuation">:</span> <span class="token javascript-expression language-javascript"><span class="token string">&quot;Followers: &quot;</span> <span class="token operator">+</span> delegate<span class="token punctuation">.</span>model<span class="token punctuation">.</span>followersCount </span><span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>The model <code>SpotifyModel</code> is defined in the <code>Spotify</code> library. To work properly, it needs a <code>SpotifyAPI</code>.</p> <p>The ListView displays a vertical list of artists. An artist is represented by a name, an image and the total count of followers.</p> <h3 id="spotifyapi"><a href="#spotifyapi" class="header-anchor">#</a> SpotifyAPI</h3> <p>Let's now get a bit deeper into the authentication flow. We'll focus on the <code>SpotifyAPI</code> class, a <code>QML_ELEMENT</code> defined on the C++ side.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SPOTIFYAPI_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SPOTIFYAPI_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtCore&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtNetwork&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtQml/qqml.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QOAuth2AuthorizationCodeFlow&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">SpotifyAPI</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QObject</span></span>
<span class="token punctuation">{</span>
    Q_OBJECT
    QML_ELEMENT

    <span class="token function">Q_PROPERTY</span><span class="token punctuation">(</span><span class="token keyword">bool</span> isAuthenticated READ isAuthenticated WRITE setAuthenticated NOTIFY isAuthenticatedChanged<span class="token punctuation">)</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">SpotifyAPI</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token keyword">bool</span> isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_isAuthenticated <span class="token operator">!=</span> isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            m_isAuthenticated <span class="token operator">=</span> isAuthenticated<span class="token punctuation">;</span>
            emit <span class="token function">isAuthenticatedChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> m_isAuthenticated<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    QNetworkReply<span class="token operator">*</span> <span class="token function">getTopArtists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setCredentials</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> clientId<span class="token punctuation">,</span> <span class="token keyword">const</span> QString<span class="token operator">&amp;</span> clientSecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

signals<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">isAuthenticatedChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    QOAuth2AuthorizationCodeFlow m_oauth2<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> m_isAuthenticated<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// SPOTIFYAPI_H</span></span>
</code></pre></div><p>First, we'll import the <code>&lt;QOAuth2AuthorizationCodeFlow&gt;</code> class. This class is a part of the <code>QtNetworkAuth</code> module, which contains various implementations of <code>OAuth</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QOAuth2AuthorizationCodeFlow&gt;</span></span>
</code></pre></div><p>Our class, <code>SpotifyAPI</code>, will define a <code>isAuthenticated</code> property:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">Q_PROPERTY</span><span class="token punctuation">(</span><span class="token keyword">bool</span> isAuthenticated READ isAuthenticated WRITE setAuthenticated NOTIFY isAuthenticatedChanged<span class="token punctuation">)</span>
</code></pre></div><p>The two public slots that we used in the QML files:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setCredentials</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> clientId<span class="token punctuation">,</span> <span class="token keyword">const</span> QString<span class="token operator">&amp;</span> clientSecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And a private member representing the authentication flow:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>QOAuth2AuthorizationCodeFlow m_oauth2<span class="token punctuation">;</span>
</code></pre></div><p>On the implementation side, we have the following code:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;spotifyapi.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtGui&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtCore&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtNetworkAuth&gt;</span></span>

<span class="token class-name">SpotifyAPI</span><span class="token operator">::</span><span class="token function">SpotifyAPI</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">QObject</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_isAuthenticated</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">setAuthorizationUrl</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://accounts.spotify.com/authorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">setAccessTokenUrl</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://accounts.spotify.com/api/token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">setScope</span><span class="token punctuation">(</span><span class="token string">&quot;user-top-read&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    m_oauth2<span class="token punctuation">.</span><span class="token function">setReplyHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">QOAuthHttpServerReplyHandler</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">setModifyParametersFunction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>QAbstractOAuth<span class="token operator">::</span>Stage stage<span class="token punctuation">,</span> QMultiMap<span class="token operator">&lt;</span>QString<span class="token punctuation">,</span> QVariant<span class="token operator">&gt;</span> <span class="token operator">*</span>parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>stage <span class="token operator">==</span> QAbstractOAuth<span class="token operator">::</span>Stage<span class="token operator">::</span>RequestingAuthorization<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            parameters<span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;duration&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;permanent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_oauth2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QOAuth2AuthorizationCodeFlow<span class="token operator">::</span>authorizeWithBrowser<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QDesktopServices<span class="token operator">::</span>openUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_oauth2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QOAuth2AuthorizationCodeFlow<span class="token operator">::</span>statusChanged<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span>QAbstractOAuth<span class="token operator">::</span>Status status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> QAbstractOAuth<span class="token operator">::</span>Status<span class="token operator">::</span>Granted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SpotifyAPI</span><span class="token operator">::</span><span class="token function">setCredentials</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString<span class="token operator">&amp;</span> clientId<span class="token punctuation">,</span> <span class="token keyword">const</span> QString<span class="token operator">&amp;</span> clientSecret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">setClientIdentifier</span><span class="token punctuation">(</span>clientId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">setClientIdentifierSharedKey</span><span class="token punctuation">(</span>clientSecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SpotifyAPI</span><span class="token operator">::</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">grant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QNetworkReply<span class="token operator">*</span> <span class="token class-name">SpotifyAPI</span><span class="token operator">::</span><span class="token function">getTopArtists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> m_oauth2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.spotify.com/v1/me/top/artists?limit=10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The constructor task mainly consists in configuring the authentication flow. First, we define the Spotify API routes that will serve as authenticators.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>m_oauth2<span class="token punctuation">.</span><span class="token function">setAuthorizationUrl</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://accounts.spotify.com/authorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m_oauth2<span class="token punctuation">.</span><span class="token function">setAccessTokenUrl</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://accounts.spotify.com/api/token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We then select the scope (= the Spotify authorizations) that we want to use:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>m_oauth2<span class="token punctuation">.</span><span class="token function">setScope</span><span class="token punctuation">(</span><span class="token string">&quot;user-top-read&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Since OAuth is a two-way communication process, we instanciate a dedicated local server to handle the replies:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>m_oauth2<span class="token punctuation">.</span><span class="token function">setReplyHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">QOAuthHttpServerReplyHandler</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finally, we configure two signals and slots.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_oauth2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QOAuth2AuthorizationCodeFlow<span class="token operator">::</span>authorizeWithBrowser<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QDesktopServices<span class="token operator">::</span>openUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_oauth2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QOAuth2AuthorizationCodeFlow<span class="token operator">::</span>statusChanged<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span>QAbstractOAuth<span class="token operator">::</span>Status status<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The first one configures the authorization to happen within a web-browser (through <code>&amp;QDesktopServices::openUrl</code>), while the second makes sure that we are notified when the authorization process has been completed.</p> <p>The <code>authorize()</code> method is only a placeholder for calling the underlying <code>grant()</code> method of the authentication flow. This is the method that triggers the process.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">SpotifyAPI</span><span class="token operator">::</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m_oauth2<span class="token punctuation">.</span><span class="token function">grant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Finally, the <code>getTopArtists()</code> calls the web api using the authorization context provided by the <code>m_oauth2</code> network access manager.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>QNetworkReply<span class="token operator">*</span> <span class="token class-name">SpotifyAPI</span><span class="token operator">::</span><span class="token function">getTopArtists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> m_oauth2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">QUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.spotify.com/v1/me/top/artists?limit=10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="the-spotify-model"><a href="#the-spotify-model" class="header-anchor">#</a> The Spotify model</h3> <p>This class is a <code>QML_ELEMENT</code> that subclasses <code>QAbstractListModel</code> to represent our list of artists. It relies on <code>SpotifyAPI</code> to gather the artists from the remote endpoint.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SPOTIFYMODEL_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SPOTIFYMODEL_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtCore&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;spotifyapi.h&quot;</span></span>

<span class="token function">QT_FORWARD_DECLARE_CLASS</span><span class="token punctuation">(</span>QNetworkReply<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">SpotifyModel</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QAbstractListModel</span></span>
<span class="token punctuation">{</span>
    Q_OBJECT
    QML_ELEMENT

    <span class="token function">Q_PROPERTY</span><span class="token punctuation">(</span>SpotifyAPI<span class="token operator">*</span> spotifyApi READ spotifyApi WRITE setSpotifyApi NOTIFY spotifyApiChanged<span class="token punctuation">)</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">SpotifyModel</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setSpotifyApi</span><span class="token punctuation">(</span>SpotifyAPI<span class="token operator">*</span> spotifyApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_spotifyApi <span class="token operator">!=</span> spotifyApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            m_spotifyApi <span class="token operator">=</span> spotifyApi<span class="token punctuation">;</span>
            emit <span class="token function">spotifyApiChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    SpotifyAPI<span class="token operator">*</span> <span class="token function">spotifyApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> m_spotifyApi<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">enum</span> <span class="token punctuation">{</span>
        NameRole <span class="token operator">=</span> Qt<span class="token operator">::</span>UserRole <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        ImageURLRole<span class="token punctuation">,</span>
        FollowersCountRole<span class="token punctuation">,</span>
        HrefRole<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    QHash<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> QByteArray<span class="token operator">&gt;</span> <span class="token function">roleNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> override<span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>parent<span class="token punctuation">)</span> <span class="token keyword">const</span> override<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">columnCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>parent<span class="token punctuation">)</span> <span class="token keyword">const</span> override<span class="token punctuation">;</span>
    QVariant <span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">,</span> <span class="token keyword">int</span> role<span class="token punctuation">)</span> <span class="token keyword">const</span> override<span class="token punctuation">;</span>

signals<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">spotifyApiChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>errorString<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    QPointer<span class="token operator">&lt;</span>SpotifyAPI<span class="token operator">&gt;</span> m_spotifyApi<span class="token punctuation">;</span>
    QList<span class="token operator">&lt;</span>QJsonObject<span class="token operator">&gt;</span> m_artists<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// SPOTIFYMODEL_H</span></span>
</code></pre></div><p>This class defines a <code>spotifyApi</code> property:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">Q_PROPERTY</span><span class="token punctuation">(</span>SpotifyAPI<span class="token operator">*</span> spotifyApi READ spotifyApi WRITE setSpotifyApi NOTIFY spotifyApiChanged<span class="token punctuation">)</span>
</code></pre></div><p>An enumeration of Roles (as per <code>QAbstractListModel</code>):</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">enum</span> <span class="token punctuation">{</span>
    NameRole <span class="token operator">=</span> Qt<span class="token operator">::</span>UserRole <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment">// The artist's name</span>
    ImageURLRole<span class="token punctuation">,</span>                   <span class="token comment">// The artist's image</span>
    FollowersCountRole<span class="token punctuation">,</span>             <span class="token comment">// The artist's followers count</span>
    HrefRole<span class="token punctuation">,</span>                       <span class="token comment">// The link to the artist's page</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>A slot to trigger the refresh of the artists list:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">public</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And, of course, the list of artists, represented as JSON objects:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">public</span> slots<span class="token operator">:</span>
    QList<span class="token operator">&lt;</span>QJsonObject<span class="token operator">&gt;</span> m_artists<span class="token punctuation">;</span>
</code></pre></div><p>On the implementation side, we have:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;spotifymodel.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtCore&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtNetwork&gt;</span></span>

<span class="token class-name">SpotifyModel</span><span class="token operator">::</span><span class="token function">SpotifyModel</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>parent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">QAbstractListModel</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

QHash<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> QByteArray<span class="token operator">&gt;</span> <span class="token class-name">SpotifyModel</span><span class="token operator">::</span><span class="token function">roleNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> QHash<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> QByteArray<span class="token operator">&gt;</span> names <span class="token punctuation">{</span>
        <span class="token punctuation">{</span> NameRole<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> ImageURLRole<span class="token punctuation">,</span> <span class="token string">&quot;imageURL&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> FollowersCountRole<span class="token punctuation">,</span> <span class="token string">&quot;followersCount&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> HrefRole<span class="token punctuation">,</span> <span class="token string">&quot;href&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> names<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token class-name">SpotifyModel</span><span class="token operator">::</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>parent<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> m_artists<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token class-name">SpotifyModel</span><span class="token operator">::</span><span class="token function">columnCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>parent<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> m_artists<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QVariant <span class="token class-name">SpotifyModel</span><span class="token operator">::</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">const</span> QModelIndex <span class="token operator">&amp;</span>index<span class="token punctuation">,</span> <span class="token keyword">int</span> role<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>index<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> Qt<span class="token operator">::</span>DisplayRole <span class="token operator">||</span> role <span class="token operator">==</span> NameRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> ImageURLRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> artistObject <span class="token operator">=</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> imagesValue <span class="token operator">=</span> artistObject<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>imagesValue<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> imagesArray <span class="token operator">=</span> imagesValue<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>imagesArray<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token keyword">auto</span> imageValue <span class="token operator">=</span> imagesArray<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> imageValue<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> FollowersCountRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> artistObject <span class="token operator">=</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> followersValue <span class="token operator">=</span> artistObject<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;followers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> followersValue<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> HrefRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">QVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SpotifyModel</span><span class="token operator">::</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_spotifyApi <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        emit <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;SpotifyModel::error: SpotifyApi is not set.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">auto</span> reply <span class="token operator">=</span> m_spotifyApi<span class="token operator">-&gt;</span><span class="token function">getTopArtists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">connect</span><span class="token punctuation">(</span>reply<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QNetworkReply<span class="token operator">::</span>finished<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        reply<span class="token operator">-&gt;</span><span class="token function">deleteLater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reply<span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> QNetworkReply<span class="token operator">::</span>NoError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            emit <span class="token function">error</span><span class="token punctuation">(</span>reply<span class="token operator">-&gt;</span><span class="token function">errorString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token keyword">auto</span> json <span class="token operator">=</span> reply<span class="token operator">-&gt;</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> document <span class="token operator">=</span> <span class="token class-name">QJsonDocument</span><span class="token operator">::</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> rootObject <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> artistsValue <span class="token operator">=</span> rootObject<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>artistsValue<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> artistsArray <span class="token operator">=</span> artistsValue<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>artistsArray<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token function">beginResetModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_artists<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> artistValue <span class="token operator">:</span> <span class="token function">qAsConst</span><span class="token punctuation">(</span>artistsArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>artistValue<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_artists<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>artistValue<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">endResetModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>update()</code> method calls the <code>getTopArtists()</code> method and handle its reply by extracting the individual items from the JSON document and refreshing the list of artists within the model.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> reply <span class="token operator">=</span> m_spotifyApi<span class="token operator">-&gt;</span><span class="token function">getTopArtists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">connect</span><span class="token punctuation">(</span>reply<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QNetworkReply<span class="token operator">::</span>finished<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    reply<span class="token operator">-&gt;</span><span class="token function">deleteLater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reply<span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> QNetworkReply<span class="token operator">::</span>NoError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        emit <span class="token function">error</span><span class="token punctuation">(</span>reply<span class="token operator">-&gt;</span><span class="token function">errorString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token keyword">auto</span> json <span class="token operator">=</span> reply<span class="token operator">-&gt;</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> document <span class="token operator">=</span> <span class="token class-name">QJsonDocument</span><span class="token operator">::</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> rootObject <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> artistsValue <span class="token operator">=</span> rootObject<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>artistsValue<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> artistsArray <span class="token operator">=</span> artistsValue<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>artistsArray<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token function">beginResetModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_artists<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> artistValue <span class="token operator">:</span> <span class="token function">qAsConst</span><span class="token punctuation">(</span>artistsArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>artistValue<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_artists<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>artistValue<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">endResetModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>data()</code> method extracts, depending on the requested model role, the relevant attributes of an Artist and returns as a <code>QVariant</code>:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> Qt<span class="token operator">::</span>DisplayRole <span class="token operator">||</span> role <span class="token operator">==</span> NameRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> ImageURLRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> artistObject <span class="token operator">=</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> imagesValue <span class="token operator">=</span> artistObject<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>imagesValue<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> imagesArray <span class="token operator">=</span> imagesValue<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>imagesArray<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token keyword">auto</span> imageValue <span class="token operator">=</span> imagesArray<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> imageValue<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> FollowersCountRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> artistObject <span class="token operator">=</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> followersValue <span class="token operator">=</span> artistObject<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;followers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> followersValue<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">==</span> HrefRole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> m_artists<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/oauth-spotify-result.77ce81ad.png" alt="image"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/qmlbook/qt6book/edit/main/docs/ch12-networking/authentication.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/18/2021, 11:20:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ch12-networking/rest-api.html" class="prev">
        REST API
      </a></span> <span class="next"><a href="/ch12-networking/web-sockets.html">
        Web Sockets
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.85861ea8.js" defer></script><script src="/assets/js/2.26c961b2.js" defer></script><script src="/assets/js/26.cdd6b54d.js" defer></script>
  </body>
</html>
