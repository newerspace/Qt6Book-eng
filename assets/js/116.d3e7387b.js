(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{642:function(e,t,a){"use strict";a.r(t);var s=a(24),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"build-systems"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-systems"}},[e._v("#")]),e._v(" Build Systems")]),e._v(" "),a("p",[e._v("Building software reliably across different platforms can be a complex task. You will encounter different environments with different compilers, paths, and library variations. The purpose of Qt is to shield the application developer from these cross-platform issues. Qt relies on "),a("a",{attrs:{href:"https://cmake.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CMake"),a("OutboundLink")],1),e._v(" to convert "),a("code",[e._v("CMakeLists.txt")]),e._v(" project files to platform specific make files, which then can be built using the platform specific tooling.")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("Qt comes with three different build systems. The original Qt build system\nwas called "),a("code",[e._v("qmake")]),e._v(". Another Qt specific build system is "),a("code",[e._v("QBS")]),e._v(" which uses a\ndeclarative approach to describing the build sequence. Since version 6, Qt\nhas shifted from "),a("code",[e._v("qmake")]),e._v(" to CMake as the official build system.")])]),e._v(" "),a("p",[e._v("A typical build flow in Qt under Unix would be:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" CMakeLists.txt\ncmake "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v(" // generates Makefile\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v("\n")])])]),a("p",[e._v("With Qt you are encouraged to use shadow builds. A shadow build is a build outside of your source code location. Assume we have a myproject folder with a "),a("code",[e._v("CMakeLists.txt")]),e._v(" file. The flow would be like this:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" build\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" build\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v("\n")])])]),a("p",[e._v("We create a build folder and then call cmake from inside the build folder with the location of our project folder. This will set up the makefile in a way that all build artifacts are stored under the build folder instead of inside our source code folder. This allows us to create builds for different qt versions and build configurations at the same time and also it does not clutter our source code folder which is always a good thing.")]),e._v(" "),a("p",[e._v("When you are using Qt Creator it does these things behind the scenes for you and you do not have to worry about these steps in most cases. For larger projects and for a deeper understanding of the flow, it is recommended that you learn to build your Qt project from the command line to ensure that you have full control over what is happening.")]),e._v(" "),a("h2",{attrs:{id:"cmake"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cmake"}},[e._v("#")]),e._v(" CMake")]),e._v(" "),a("p",[e._v("CMake is a tool created by Kitware. Kitware is very well known for their 3D visualization software VTK and also CMake, the cross-platform makefile generator. It uses a series of "),a("code",[e._v("CMakeLists.txt")]),e._v(" files to generate platform-specific makefiles. CMake is used by the KDE project and as such has a special relationship with the Qt community and since version 6, it is the preferred way to build Qt projects.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("CMakeLists.txt")]),e._v(" is the file used to store the project configuration. For a simple hello world using Qt Core the project file would look like this:")]),e._v(" "),a("div",{staticClass:"language-cmake extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cmake"}},[a("code",[e._v("// ensure cmake version is at least "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.16.0")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("cmake_minimum_required")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token property"}},[e._v("VERSION")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.16.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n// defines a project with a version\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("project")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("foundation_tests "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v("VERSION")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.0.0")]),e._v(" LANGUAGES CXX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n// pick the C++ standard to use, in this case C++"),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("17")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("CMAKE_CXX_STANDARD")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("17")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("CMAKE_CXX_STANDARD_REQUIRED")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("ON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n// tell CMake to run the Qt tools moc, rcc, and uic automatically\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("CMAKE_AUTOMOC")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("ON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("CMAKE_AUTORCC")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("ON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("CMAKE_AUTOUIC")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("ON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n// configure the Qt "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v(" modules core and test\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("find_package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Qt6 COMPONENTS Core REQUIRED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("find_package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Qt6 COMPONENTS Test REQUIRED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n// define an executable built from a source file\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("add_executable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("foundation_tests\n    tst_foundation.cpp\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n// tell cmake to link the executable to the Qt "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v(" core and test modules\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("target_link_libraries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("foundation_tests "),a("span",{pre:!0,attrs:{class:"token namespace"}},[e._v("PRIVATE")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token inserted class-name"}},[e._v("Qt6::Core")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token inserted class-name"}},[e._v("Qt6::Test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("This will build a "),a("code",[e._v("foundations_tests")]),e._v(" executable using "),a("code",[e._v("tst_foundation.cpp")]),e._v(" and link against the Core and Test libraries from Qt 6. You will find more examples of CMake files in this book, as we use CMake for all C++ based examples.")]),e._v(" "),a("p",[e._v("CMake is a powerful, a complex, tool and it takes some time to get used to the syntax. CMake is very flexible and really shines in large and complex projects.")]),e._v(" "),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"http://www.cmake.org/documentation/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CMake Help"),a("OutboundLink")],1),e._v(" - available online but also as Qt Help format")])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://www.cmake.org/runningcmake/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Running CMake"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://techbase.kde.org/Development/Tutorials/CMake",target:"_blank",rel:"noopener noreferrer"}},[e._v("KDE CMake Tutorial"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://www.kitware.com/products/books/CMakeBook.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CMake Book"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://www.cmake.org/cmake/help/v3.0/manual/cmake-qt.7.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CMake and Qt"),a("OutboundLink")],1)])])]),e._v(" "),a("h2",{attrs:{id:"qmake"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#qmake"}},[e._v("#")]),e._v(" QMake")]),e._v(" "),a("p",[e._v("QMake is the tool which reads your project file and generates the build file. A project file is a simplified write-down of your project configuration, external dependencies, and your source files. The simplest project file is probably this:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// myproject.pro")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SOURCES")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\n")])])]),a("p",[e._v("Here we build an executable application which will have the name "),a("code",[e._v("myproject")]),e._v(" based on the project file name. The build will only contain the "),a("code",[e._v("main.cpp")]),e._v(" source file. And by default, we will use the "),a("code",[e._v("QtCore")]),e._v(" and "),a("code",[e._v("QtGui")]),e._v(" module for this project. If our project were a QML application we would need to add the "),a("code",[e._v("QtQuick")]),e._v(" and "),a("code",[e._v("QtQml")]),e._v(" module to the list:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// myproject.pro")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("QT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" qml quick\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SOURCES")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\n")])])]),a("p",[e._v("Now the build file knows to link against the "),a("code",[e._v("QtQml")]),e._v(" and "),a("code",[e._v("QtQuick")]),e._v(" Qt modules. QMake uses the concept of "),a("code",[e._v("=")]),e._v(", "),a("code",[e._v("+=")]),e._v(" and "),a("code",[e._v("-=")]),e._v(" to assign, add, remove elements from a list of options, respectively. For a pure console build without UI dependencies you would remove the "),a("code",[e._v("QtGui")]),e._v(" module:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// myproject.pro")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("QT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-=")]),e._v(" gui\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SOURCES")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\n")])])]),a("p",[e._v("When you want to build a library instead of an application, you need to change the build template:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// myproject.pro")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("TEMPLATE")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" lib\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("QT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-=")]),e._v(" gui\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("HEADERS")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("h\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SOURCES")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\n")])])]),a("p",[e._v("Now the project will build as a library without UI dependencies and used the "),a("code",[e._v("utils.h")]),e._v(" header and the "),a("code",[e._v("utils.cpp")]),e._v(" source file. The format of the library will depend on the OS you are building the project.")]),e._v(" "),a("p",[e._v("Often you will have more complicated setups and need to build a set of projects. For this, qmake offers the "),a("code",[e._v("subdirs")]),e._v(" template. Assume we would have a mylib and a myapp project. Then our setup could be like this:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("pro\nmylib"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("mylib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("pro\nmylib"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("h\nmylib"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\nmyapp"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("myapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("pro\nmyapp"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\n")])])]),a("p",[e._v("We know already how the mylib.pro and myapp.pro would look like. The my.pro as the overarching project file would look like this:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// my.pro")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("TEMPLATE")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" subdirs\n\nsubdirs "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" mylib \\\n    myapp\n\nmyapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("depends "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" mylib\n")])])]),a("p",[e._v("This declares a project with two subprojects: "),a("code",[e._v("mylib")]),e._v(" and "),a("code",[e._v("myapp")]),e._v(", where "),a("code",[e._v("myapp")]),e._v(" depends on "),a("code",[e._v("mylib")]),e._v(". When you run qmake on this project file it will generate file a build file for each project in a corresponding folder. When you run the makefile for "),a("code",[e._v("my.pro")]),e._v(", all subprojects are also built.")]),e._v(" "),a("p",[e._v("Sometimes you need to do one thing on one platform and another thing on other platforms based on your configuration. For this qmake introduces the concept of scopes. A scope is applied when a configuration option is set to true.")]),e._v(" "),a("p",[e._v("For example, to use a Unix specific utils implementation you could use:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("unix "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SOURCES")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" utils_unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("SOURCES")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+=")]),e._v(" utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("cpp\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("What it says is if the CONFIG variable contains a Unix option then apply this scope otherwise use the else path. A typical one is to remove the application bundling under mac:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("macx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("CONFIG")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-=")]),e._v(" app_bundle\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("This will create your application as a plain executable under mac and not as a "),a("code",[e._v(".app")]),e._v(" folder which is used for application installation.")]),e._v(" "),a("p",[e._v("QMake based projects are normally the number one choice when you start programming Qt applications. There are also other options out there. All have their benefits and drawbacks. We will shortly discuss these other options next.")]),e._v(" "),a("h2",{attrs:{id:"references-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references-2"}},[e._v("#")]),e._v(" References")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"http://doc.qt.io/qt-5//qmake-manual.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("QMake Manual"),a("OutboundLink")],1),e._v(" - Table of contents of the qmake manual")])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://doc.qt.io/qt-5//qmake-language.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("QMake Language"),a("OutboundLink")],1),e._v(" - Value assignment, scopes and so like")])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://doc.qt.io/qt-5//qmake-variable-reference.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("QMake Variables"),a("OutboundLink")],1),e._v(" - Variables like TEMPLATE, CONFIG, QT is explained here")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);