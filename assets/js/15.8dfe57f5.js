(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{486:function(t,a,s){t.exports=s.p+"assets/img/redlense1.419cf034.png"},487:function(t,a,s){t.exports=s.p+"assets/img/redlense2.a1396cab.png"},488:function(t,a,s){t.exports=s.p+"assets/img/redlense3.7d32d38a.png"},489:function(t,a,s){t.exports=s.p+"assets/img/redlense4.557c336c.png"},490:function(t,a,s){t.exports=s.p+"assets/img/redlense5.986d081b.png"},602:function(t,a,s){"use strict";s.r(a);var e=s(24),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"fragment-shaders"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fragment-shaders"}},[t._v("#")]),t._v(" Fragment Shaders")]),t._v(" "),e("p",[t._v("The fragment shader is called for every pixel to be rendered. In this chapter, we will develop a small red lens which will increase the red color channel value of the source.")]),t._v(" "),e("h2",{attrs:{id:"setting-up-the-scene"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-the-scene"}},[t._v("#")]),t._v(" Setting up the scene")]),t._v(" "),e("p",[t._v("First, we set up our scene, with a grid centered in the field and our source image be displayed.")]),t._v(" "),e("div",{staticClass:"language-qml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-qml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" QtQuick\n\n"),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Rectangle")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("480")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("240")])]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("color")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#1e1e1e'")])]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Grid")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("anchors.centerIn")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("parent")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("spacing")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")])]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("rows")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("columns")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")])]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("sourceImage")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("width")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../assets/tulips.jpg'")])]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])])])]),e("p",[e("img",{attrs:{src:s(486),alt:"image"}})]),t._v(" "),e("h2",{attrs:{id:"a-red-shader"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-red-shader"}},[t._v("#")]),t._v(" A red shader")]),t._v(" "),e("p",[t._v("Next, we will add a shader, which displays a red rectangle by providing for each fragment a red color value.")]),t._v(" "),e("div",{staticClass:"language-frag extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("div",{staticClass:"highlighted"},[t._v(" ")])]),e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#version 440\n\nlayout(location=0) in vec2 qt_TexCoord0;\n\nlayout(location=0) out vec4 fragColor;\n\nlayout(std140, binding=0) uniform buf {\n    mat4 qt_Matrix;\n    float qt_Opacity;\n} ubuf;\n\nlayout(binding=1) uniform sampler2D source;\n\nvoid main() {\n    fragColor = vec4(1.0, 0.0, 0.0, 1.0) * ubuf.qt_Opacity;\n}")])])]),e("p",[t._v("In the fragment shader we simply assign a "),e("code",[t._v("vec4(1.0, 0.0, 0.0, 1.0)")]),t._v(", representing the color red with full opacity (alpha=1.0), to the "),e("code",[t._v("fragColor")]),t._v(" for each fragment, turning each pixel to a solid red.")]),t._v(" "),e("p",[e("img",{attrs:{src:s(487),alt:"image"}})]),t._v(" "),e("h2",{attrs:{id:"a-red-shader-with-texture"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-red-shader-with-texture"}},[t._v("#")]),t._v(" A red shader with texture")]),t._v(" "),e("p",[t._v("Now we want to apply the red color to each texture pixel. For this, we need the texture back in the vertex shader. As we don’t do anything else in the vertex shader the default vertex shader is enough for us. We just need to provide a compatible fragment shader.")]),t._v(" "),e("div",{staticClass:"language-frag extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("div",{staticClass:"highlighted"},[t._v(" ")])]),e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#version 440\n\nlayout(location=0) in vec2 qt_TexCoord0;\n\nlayout(location=0) out vec4 fragColor;\n\nlayout(std140, binding=0) uniform buf {\n    mat4 qt_Matrix;\n    float qt_Opacity;\n} ubuf;\n\nlayout(binding=1) uniform sampler2D source;\n\nvoid main() {\n    fragColor = texture(source, qt_TexCoord0) * vec4(1.0, 0.0, 0.0, 1.0) * ubuf.qt_Opacity;\n}")])])]),e("p",[t._v("The full shader contains now back our image source as variant property and we have left out the vertex shader, which if not specified is the default vertex shader.")]),t._v(" "),e("p",[t._v("In the fragment shader, we pick the texture fragment "),e("code",[t._v("texture(source, qt_TexCoord0)")]),t._v(" and apply the red color to it.")]),t._v(" "),e("p",[e("img",{attrs:{src:s(488),alt:"image"}})]),t._v(" "),e("h2",{attrs:{id:"the-red-channel-property"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-red-channel-property"}},[t._v("#")]),t._v(" The red channel property")]),t._v(" "),e("p",[t._v("It’s not really nice to hard code the red channel value, so we would like to control the value from the QML side. For this we add a "),e("em",[t._v("redChannel")]),t._v(" property to our shader effect and also declare a "),e("code",[t._v("float redChannel")]),t._v(" inside the uniform buffer of the fragment shader. That is all that we need to do to make a value from the QML side available to the shader code.")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Notice that the "),e("code",[t._v("redChannel")]),t._v(" must come after the implicit "),e("code",[t._v("qt_Matrix")]),t._v(" and "),e("code",[t._v("qt_Opacity")]),t._v(" in the uniform buffer, "),e("code",[t._v("ubuf")]),t._v(". The order of the parameters after the "),e("code",[t._v("qt_")]),t._v(" parameters is up to you, but "),e("code",[t._v("qt_Matrix")]),t._v(" and "),e("code",[t._v("qt_Opacity")]),t._v(" must come first and in that order.")])]),t._v(" "),e("div",{staticClass:"language-frag extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#version 440\n\nlayout(location=0) in vec2 qt_TexCoord0;\n\nlayout(location=0) out vec4 fragColor;\n\nlayout(std140, binding=0) uniform buf {\n    mat4 qt_Matrix;\n    float qt_Opacity;\n    \n    float redChannel;\n} ubuf;\n\nlayout(binding=1) uniform sampler2D source;\n\nvoid main() {\n    fragColor = texture(source, qt_TexCoord0) * vec4(ubuf.redChannel, 1.0, 1.0, 1.0) * ubuf.qt_Opacity;\n}")])])]),e("p",[t._v("To make the lens really a lens, we change the "),e("em",[t._v("vec4")]),t._v(" color to be "),e("em",[t._v("vec4(redChannel, 1.0, 1.0, 1.0)")]),t._v(" so that the other colors are multiplied by 1.0 and only the red portion is multiplied by our "),e("em",[t._v("redChannel")]),t._v(" variable.")]),t._v(" "),e("p",[e("img",{attrs:{src:s(489),alt:"image"}})]),t._v(" "),e("h2",{attrs:{id:"the-red-channel-animated"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-red-channel-animated"}},[t._v("#")]),t._v(" The red channel animated")]),t._v(" "),e("p",[t._v("As the "),e("em",[t._v("redChannel")]),t._v(" property is just a normal property it can also be animated as all properties in QML. So we can use QML properties to animate values on the GPU to influence our shaders. How cool is that!")]),t._v(" "),e("div",{staticClass:"language-qml extra-class"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("div",{staticClass:"highlighted"},[t._v(" ")]),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-qml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShaderEffect")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("effect4")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("width")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("property")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("variant")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("sourceImage")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("property")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("real")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("redChannel")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.3")])]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("visible")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("step"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")])]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NumberAnimation")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" redChannel "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("to")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("loops")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("Animation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Infinite")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("duration")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")])]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("fragmentShader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red3.frag.qsb"')])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])])])]),e("p",[t._v("Here the final result.")]),t._v(" "),e("p",[e("img",{attrs:{src:s(490),alt:"image"}})]),t._v(" "),e("p",[t._v("The shader effect on the 2nd row is animated from 0.0 to 1.0 with a duration of 4 seconds. So the image goes from no red information (0.0 red) over to a normal image (1.0 red).")]),t._v(" "),e("h2",{attrs:{id:"baking"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#baking"}},[t._v("#")]),t._v(" Baking")]),t._v(" "),e("p",[t._v("Again, we need to bake the shaders. The following commands from the command line does that:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("qsb --glsl 100es,120,150 --hlsl 50 --msl 12 -o red1.frag.qsb red1.frag\nqsb --glsl 100es,120,150 --hlsl 50 --msl 12 -o red2.frag.qsb red2.frag\nqsb --glsl 100es,120,150 --hlsl 50 --msl 12 -o red3.frag.qsb red3.frag\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);