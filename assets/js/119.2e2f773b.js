(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{646:function(e,t,a){"use strict";a.r(t);var s=a(24),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"creating-the-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-the-plugin"}},[e._v("#")]),e._v(" Creating the plugin")]),e._v(" "),a("p",[e._v("Qt Creator contains a wizard to create a "),a("strong",[e._v("QtQuick 2 QML Extension Plugin")]),e._v(", found under "),a("strong",[e._v("Library")]),e._v(" when creating a new project. We use it to create a plugin called "),a("code",[e._v("fileio")]),e._v(" with a "),a("code",[e._v("FileIO")]),e._v(" object to start within the module "),a("code",[e._v("org.example.io")]),e._v(".")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("The current wizard generates a QMake based project. Please use the example from this chapter as a starting point to build a CMake based project.")])]),e._v(" "),a("p",[e._v("The project should consist of the "),a("code",[e._v("fileio.h")]),e._v(" and "),a("code",[e._v("fileio.cpp")]),e._v(", that declare and implement the "),a("code",[e._v("FileIO")]),e._v(" type, and a "),a("code",[e._v("fileio_plugin.cpp")]),e._v(" that contains the actual plugin class that allows the QML engine to discover out extension.")]),e._v(" "),a("p",[e._v("The plugin class is derived from the "),a("code",[e._v("QQmlEngineExtensionPlugin")]),e._v(" class, and contains a the "),a("code",[e._v("Q_OBJECT")]),e._v(" and "),a("code",[e._v("Q_PLUGIN_METADATA")]),e._v(" macros. The entire file can be seen below.")]),e._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[e._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("<QQmlEngineExtensionPlugin>")])]),e._v("\r\n\r\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("FileioPlugin")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token base-clause"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("QQmlEngineExtensionPlugin")])]),e._v("\r\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\r\n    Q_OBJECT\r\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Q_PLUGIN_METADATA")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("IID QQmlEngineExtensionInterface_iid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\r\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\r\n\r\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[e._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"fileio_plugin.moc"')])]),e._v("\r\n")])])]),a("p",[e._v("The extension will automatically discover and register all types marked with "),a("code",[e._v("QML_ELEMENT")]),e._v(" and "),a("code",[e._v("QML_NAMED_ELEMENT")]),e._v(". We will see how this is done in the FileIO Implementation section below.")]),e._v(" "),a("p",[e._v("For the import of the module to work, the user also needs to specify a URI, e.g. "),a("code",[e._v("import org.example.io")]),e._v(". Interestingly we cannot see the module URI anywhere. This is set from the outside using a "),a("code",[e._v("qmldir")]),e._v(" file, alternatively in the "),a("code",[e._v("CMakeLists.txt")]),e._v(" file of your project.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("qmldir")]),e._v(" file specifies the content of your QML plugin or better the QML side of your plugin. A hand-written "),a("code",[e._v("qmldir")]),e._v(" file for our plugin should look something like this:")]),e._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[e._v("module org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("io\nplugin fileio\n")])])]),a("p",[e._v("The module is the URI that the user imports, and after it you name which plugin to load for the said URI. The plugin line must be identical with your plugin file name (under mac this would be "),a("em",[e._v("libfileio_debug.dylib")]),e._v(" on the file system and "),a("em",[e._v("fileio")]),e._v(" in the "),a("em",[e._v("qmldir")]),e._v(", for a Linux system, the same line would look for "),a("em",[e._v("libfileio.so")]),e._v("). These files are created by Qt Creator based on the given information.")]),e._v(" "),a("p",[e._v("The easier way to create a correct "),a("code",[e._v("qmldir")]),e._v(" file is in the "),a("code",[e._v("CMakeLists.txt")]),e._v(" for your project, in the "),a("code",[e._v("qt_add_qml_module")]),e._v(" macro. Here, the "),a("code",[e._v("URI")]),e._v(" parameter is used to specify the URI of the plugin, e.g. "),a("code",[e._v("org.example.io")]),e._v(". This way, the "),a("code",[e._v("qmldir")]),e._v(" file is generated when the project is built.")]),e._v(" "),a("p",[e._v("::: TODO\nHow to install the module?\n:::")]),e._v(" "),a("p",[e._v("When importing a module called “org.example.io”, the QML engine will look in one of the import paths and tries to locate the “org/example/io” path with a qmldir. The qmldir then will tell the engine which library to load as a QML extension plugin using which module URI. Two modules with the same URI will override each other.")])])}),[],!1,null,null,null);t.default=n.exports}}]);