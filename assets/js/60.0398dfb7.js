(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{500:function(t,e,a){t.exports=a.p+"assets/img/defaultshader.1eace649.png"},609:function(t,e,a){"use strict";a.r(e);var s=a(24),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"shader-elements"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shader-elements"}},[t._v("#")]),t._v(" Shader Elements")]),t._v(" "),s("p",[t._v("For programming shaders, Qt Quick provides two elements. The "),s("code",[t._v("ShaderEffectSource")]),t._v(" and the "),s("code",[t._v("ShaderEffect")]),t._v(". The shader effect applies custom shaders and the shader effect source renders a QML item into a texture and renders it. As shader effect can apply custom shaders to its rectangular shape and can use sources for the shader operation. A source can be an image, which is used as a texture or a shader effect source.")]),t._v(" "),s("p",[t._v("The default shader uses the source and renders it unmodified. Below, we first see the QML file with two "),s("code",[t._v("ShaderEffect")]),t._v(" elements. One without any shaders specified, and one explicitly specifying default vertex and fragment shaders. We will look at the shaders shortly.")]),t._v(" "),s("div",{staticClass:"language-qml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-qml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" QtQuick\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Rectangle")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("480")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("240")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("color")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#1e1e1e'")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Row")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("anchors.centerIn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("parent")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("spacing")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("sourceImage")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("width")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../assets/tulips.jpg'")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShaderEffect")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("effect")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("width")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("variant")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("sourceImage")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShaderEffect")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("effect2")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("width")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("variant")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[t._v("sourceImage")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("vertexShader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default.vert.qsb"')])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("fragmentShader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token javascript-expression language-javascript"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default.frag.qsb"')])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])])])]),s("p",[s("img",{attrs:{src:a(500),alt:"image"}})]),t._v(" "),s("p",[t._v("In the above example, we have a row of 3 images. The first is the real image. The second is rendered using the default shader and the third is rendered using the shader code for the fragment and vertex as shown below. Let's have a look at the shaders.")]),t._v(" "),s("p",[t._v("The vertex shader takes the texture coordinate, "),s("code",[t._v("qt_MultiTexCoord0")]),t._v(", and propagates it to the "),s("code",[t._v("qt_TexCoord0")]),t._v(" variable. It also takes the "),s("code",[t._v("qt_Vertex")]),t._v(" position and multiplies it with Qt's transformation matrix, "),s("code",[t._v("ubuf.qt_Matrix")]),t._v(", and returns it through the "),s("code",[t._v("gl_Position")]),t._v(" variable. This leaves the texture and vertex position on the screen unmodified.")]),t._v(" "),s("div",{staticClass:"language-vert extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#version 440\n\nlayout(location=0) in vec4 qt_Vertex;\nlayout(location=1) in vec2 qt_MultiTexCoord0;\n\nlayout(location=0) out vec2 qt_TexCoord0;\n\nlayout(std140, binding=0) uniform buf {\n    mat4 qt_Matrix;\n    float qt_Opacity;\n} ubuf;\n\nout gl_PerVertex { \n    vec4 gl_Position;\n};\n\nvoid main() {\n    qt_TexCoord0 = qt_MultiTexCoord0;\n    gl_Position = ubuf.qt_Matrix * qt_Vertex;\n}")])])]),s("p",[t._v("The fragment shader takes the texture from the "),s("code",[t._v("source")]),t._v(" 2D sampler, i.e. the texture, at the coordinate "),s("code",[t._v("qt_TexCoord0")]),t._v(" and multiplies it with the Qt opacity, "),s("code",[t._v("ubuf.qt_Opacity")]),t._v(" to calculate the "),s("code",[t._v("fragColor")]),t._v(" which is the color to be used for the pixel.")]),t._v(" "),s("div",{staticClass:"language-frag extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#version 440\n\nlayout(location=0) in vec2 qt_TexCoord0;\n\nlayout(location=0) out vec4 fragColor;\n\nlayout(std140, binding=0) uniform buf {\n    mat4 qt_Matrix;\n    float qt_Opacity;\n} ubuf;\n\nlayout(binding=1) uniform sampler2D source;\n\nvoid main() {\n    fragColor = texture(source, qt_TexCoord0) * ubuf.qt_Opacity;\n}")])])]),s("p",[t._v("Notice that these two shaders can serve as the boilerplate code for your own shaders. The variables, locations and bindings, are what Qt expects. You can read more about the exact details of this on the "),s("a",{attrs:{href:"https://doc-snapshots.qt.io/qt6-6.2/qml-qtquick-shadereffect.html#details",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shader Effect Documentation"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("Before we can use the shaders, they need to be baked. If the shaders are a part of a larger Qt project and included as resources, this can be automated. However, when working with the shaders and a "),s("code",[t._v("qml")]),t._v("-file, we need to explicitly bake them by hand. This is done using the following two commands:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("qsb --glsl 100es,120,150 --hlsl 50 --msl 12    -o default.frag.qsb default.frag \nqsb --glsl 100es,120,150 --hlsl 50 --msl 12 -b -o default.vert.qsb default.vert\n")])])]),s("p",[t._v("The "),s("code",[t._v("qsb")]),t._v(" tool is located in the "),s("code",[t._v("bin")]),t._v(" directory of your Qt 6 installation.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("If you don’t want to see the source image and only the effected image you can set the "),s("em",[t._v("Image")]),t._v(" to invisible (`` visible: false``). The shader effects will still use the image data just the "),s("em",[t._v("Image")]),t._v(" element will not be rendered.")])]),t._v(" "),s("p",[t._v("In the next examples, we will be playing around with some simple shader mechanics. First, we concentrate on the fragment shader and then we will come back to the vertex shader.")])])}),[],!1,null,null,null);e.default=n.exports}}]);